<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDV Petshop ‚Äî Single File (Melhorado)</title>
  <style>
    /* -------------------- THEME -------------------- */
    :root{
      --bg:#0b1020; --surface:#0f1724; --muted:#94a3b8; --accent:#2dd4bf; --accent-2:#60a5fa; --card:#0b1220;
      --success:#10b981; --danger:#ef4444; --glass: rgba(255,255,255,0.04);
      --radius:12px; --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,var(--bg),#071027); color:#e6eef6}

    /* -------------------- LAYOUT -------------------- */
    .app{display:grid; grid-template-columns:260px 1fr; height:100vh; gap:18px}
    aside{padding:20px; background:linear-gradient(180deg,var(--surface), rgba(15,23,36,0.6)); border-right:1px solid rgba(255,255,255,0.03)}
    header{display:flex; align-items:center; gap:12px; padding:18px; border-bottom:1px solid rgba(255,255,255,0.03); background:transparent}
    main{padding:20px; overflow:auto}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; font-weight:700}
    h1{font-size:16px; margin:0}
    .muted{color:var(--muted); font-size:13px}

    /* -------------------- SIDEBAR -------------------- */
    nav{margin-top:18px}
    .nav-item{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; color:var(--muted); cursor:pointer}
    .nav-item.active{background:linear-gradient(90deg, rgba(45,212,191,0.12), rgba(96,165,250,0.06)); color:var(--accent)}
    .nav-item:hover{background:var(--glass)}

    /* quick actions */
    .actions{margin-top:16px; display:flex; gap:8px; flex-wrap:wrap}
    .btn{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:8px 12px; border-radius:10px; color:var(--accent); cursor:pointer}
    .btn.ghost{background:transparent}
    .btn.warn{background:rgba(239,68,68,0.12); border-color:rgba(239,68,68,0.16); color:var(--danger)}

    /* -------------------- PANELS -------------------- */
    .grid{display:grid; grid-template-columns:1fr 360px; gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:16px; box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .card h2{margin:0 0 12px 0}

    /* table */
    table{width:100%; border-collapse:collapse; font-size:14px}
    th, td{padding:8px 10px; text-align:left}
    thead th{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.6px}
    tbody tr{border-top:1px solid rgba(255,255,255,0.02)}

    /* form controls */
    label{font-size:13px; color:var(--muted)}
    input[type="text"], input[type="number"], input[type="date"], select, textarea{width:100%; padding:10px; margin-top:6px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.04); color:inherit}
    .row{display:flex; gap:8px}
    .col{flex:1}

    /* cart */
    .cart{display:flex; flex-direction:column; gap:10px}
    .cart-list{max-height:360px; overflow:auto}
    .cart-item{display:flex; justify-content:space-between; gap:8px; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02)}
    .total{font-weight:700; font-size:18px}

    /* modal */
    .modal-backdrop{position:fixed; inset:0; background:rgba(2,6,23,0.6); display:flex; align-items:center; justify-content:center}
    .modal{width:820px; max-width:95%; border-radius:14px; padding:18px}

    /* responsive */
    @media(max-width:1000px){.app{grid-template-columns:1fr} .grid{grid-template-columns:1fr} aside{display:flex; gap:8px; overflow:auto} header{flex-wrap:wrap}}

    /* small helpers */
    .muted-sm{font-size:12px; color:var(--muted)}
    .pill{padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.03); font-size:13px}
    .danger{color:var(--danger)}
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <div class="brand">
        <div class="logo">PD</div>
        <div>
          <h1>PDV Petshop</h1>
          <div class="muted">Offline ‚Ä¢ localStorage</div>
        </div>
      </div>

      <nav>
        <div class="nav-item active" data-section="dashboard">üè† Painel</div>
        <div class="nav-item" data-section="vendas">üõí Vendas</div>
        <div class="nav-item" data-section="estoque">üì¶ Estoque</div>
        <div class="nav-item" data-section="clientes">üë• Clientes</div>
        <div class="nav-item" data-section="historico">üìú Hist√≥rico</div>
        <div class="nav-item" data-section="config">‚öôÔ∏è Config</div>
      </nav>

      <div class="actions">
        <button class="btn" id="newSaleBtn">Nova venda</button>
        <button class="btn" id="newProductBtn">+ Produto</button>
        <button class="btn" id="newClientBtn">+ Cliente</button>
        <button class="btn warn" id="clearAllBtn">Limpar dados</button>
      </div>

      <div style="margin-top:18px">
        <div class="muted-sm">Pesquisar</div>
        <input id="quickSearch" type="text" placeholder="Buscar produto ou cliente..." />
      </div>

      <div style="margin-top:18px" class="muted-sm">Export / Import</div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn" id="exportBtn">Exportar JSON</button>
        <button class="btn" id="importBtn">Importar</button>
      </div>

    </aside>

    <div style="display:flex; flex-direction:column; height:100vh">
      <header>
        <div style="flex:1"></div>
        <div class="muted">Usu√°rio: <b>Operador</b></div>
      </header>

      <main>
        <!-- SECTIONS -->
        <section id="dashboard" class="card section">
          <h2>Painel</h2>
          <div style="display:flex; gap:16px; align-items:center;">
            <div style="flex:1; display:grid; grid-template-columns:repeat(3,1fr); gap:12px">
              <div class="card" style="padding:12px">
                <div class="muted-sm">Produtos</div>
                <div style="font-size:20px; font-weight:700" id="statProducts">0</div>
              </div>
              <div class="card" style="padding:12px">
                <div class="muted-sm">Clientes</div>
                <div style="font-size:20px; font-weight:700" id="statClients">0</div>
              </div>
              <div class="card" style="padding:12px">
                <div class="muted-sm">Vendas (total)</div>
                <div style="font-size:20px; font-weight:700" id="statSales">R$ 0.00</div>
              </div>
            </div>

            <div style="width:360px" class="card">
              <h3 style="margin:0 0 8px 0">Carrinho R√°pido</h3>
              <div class="cart">
                <div style="display:flex; gap:8px">
                  <select id="fastProduct" style="flex:1"></select>
                  <input id="fastQty" type="number" value="1" style="width:72px" />
                  <button class="btn" id="fastAdd">Adicionar</button>
                </div>
                <div class="cart-list" id="fastCartList"></div>
                <div style="display:flex; justify-content:space-between; align-items:center">
                  <div class="pill">Total: R$ <span id="fastTotal">0.00</span></div>
                  <div><button class="btn" id="fastCheckout">Finalizar</button></div>
                </div>
              </div>
            </div>

          </div>
        </section>

        <section id="vendas" class="card section" style="display:none; margin-top:16px">
          <h2>Vendas</h2>
          <div style="display:flex; gap:12px">
            <div style="flex:1">
              <div class="card">
                <div style="display:flex; gap:8px; align-items:end">
                  <div style="flex:1">
                    <label>Cliente</label>
                    <select id="saleClient"></select>
                  </div>
                  <div style="width:160px">
                    <label>Data</label>
                    <input id="saleDate" type="date" />
                  </div>
                  <div style="width:120px"><button class="btn" id="startSale">Iniciar venda</button></div>
                </div>

                <div id="posArea" style="margin-top:12px; display:none">
                  <div style="display:flex; gap:8px; align-items:end">
                    <div style="flex:1">
                      <label>Produto</label>
                      <select id="saleProduct"></select>
                    </div>
                    <div style="width:90px">
                      <label>Qtd</label>
                      <input id="saleQty" type="number" value="1" />
                    </div>
                    <div style="width:120px"><button class="btn" id="addItemBtn">Adicionar</button></div>
                  </div>

                  <div style="margin-top:12px">
                    <table>
                      <thead><tr><th>Produto</th><th>Qtd</th><th>Pre√ßo</th><th>Subtotal</th><th></th></tr></thead>
                      <tbody id="cartTableBody"></tbody>
                    </table>
                  </div>

                  <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px">
                    <div class="muted-sm">Itens: <span id="saleItemsCount">0</span></div>
                    <div style="display:flex; gap:8px; align-items:center">
                      <div class="pill">Total: R$ <span id="saleTotal">0.00</span></div>
                      <button class="btn" id="finishSaleBtn">Finalizar venda</button>
                    </div>
                  </div>

                  <div style="margin-top:12px"><label>Comprovante</label><pre id="saleReceipt" style="white-space:pre-wrap; background:#061024; padding:10px; border-radius:8px; font-family:var(--mono)">‚Äî</pre></div>
                </div>

              </div>
            </div>

            <div style="width:360px">
              <div class="card">
                <h3 style="margin:0 0 8px 0">Atalhos</h3>
                <div style="display:flex; gap:8px; flex-direction:column">
                  <button class="btn" id="btnScan">Simular Leitura de C√≥digo</button>
                  <button class="btn" id="btnQuickPay">Pagamento R√°pido</button>
                  <button class="btn" id="btnPrintReceipt">Imprimir Comprovante</button>
                </div>
              </div>
            </div>

          </div>
        </section>

        <section id="estoque" class="card section" style="display:none; margin-top:16px">
          <h2>Estoque</h2>
          <div style="display:flex; gap:12px">
            <div style="flex:1">
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
                <input id="prodSearch" placeholder="Filtrar produtos..." />
                <div style="margin-left:auto" class="muted-sm">Total: <span id="prodCount">0</span></div>
              </div>

              <table>
                <thead><tr><th>SKU</th><th>Nome</th><th>Pre√ßo</th><th>Estoque</th><th></th></tr></thead>
                <tbody id="prodTableBody"></tbody>
              </table>
            </div>

            <div style="width:360px">
              <div class="card">
                <h3>Novo / Editar Produto</h3>
                <div style="display:grid; grid-template-columns:1fr; gap:8px; margin-top:8px">
                  <label>Nome</label>
                  <input id="p_name" />
                  <label>SKU</label>
                  <input id="p_sku" />
                  <label>Pre√ßo (R$)</label>
                  <input id="p_price" type="number" step="0.01" />
                  <label>Quantidade</label>
                  <input id="p_qty" type="number" />
                  <div style="display:flex; gap:8px"><button class="btn" id="saveProductBtn">Salvar</button><button class="btn ghost" id="resetProductBtn">Limpar</button></div>
                </div>
              </div>
            </div>

          </div>
        </section>

        <section id="clientes" class="card section" style="display:none; margin-top:16px">
          <h2>Clientes</h2>
          <div style="display:flex; gap:12px">
            <div style="flex:1">
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
                <input id="clientSearch" placeholder="Pesquisar clientes..." />
                <div style="margin-left:auto" class="muted-sm">Total: <span id="clientCount">0</span></div>
              </div>

              <table>
                <thead><tr><th>Nome</th><th>Telefone</th><th>Email</th><th></th></tr></thead>
                <tbody id="clientTableBody"></tbody>
              </table>
            </div>

            <div style="width:360px">
              <div class="card">
                <h3>Novo / Editar Cliente</h3>
                <label>Nome</label>
                <input id="c_name" />
                <label>Telefone</label>
                <input id="c_phone" />
                <label>Email</label>
                <input id="c_email" />
                <label>Observa√ß√£o</label>
                <textarea id="c_note" rows="3"></textarea>
                <div style="display:flex; gap:8px; margin-top:8px"><button class="btn" id="saveClientBtn">Salvar</button><button class="btn ghost" id="resetClientBtn">Limpar</button></div>
              </div>
            </div>
          </div>
        </section>

        <section id="historico" class="card section" style="display:none; margin-top:16px">
          <h2>Hist√≥rico de Vendas</h2>
          <table>
            <thead><tr><th>Data</th><th>Cliente</th><th>Itens</th><th>Total</th><th></th></tr></thead>
            <tbody id="salesHistoryBody"></tbody>
          </table>
        </section>

        <section id="config" class="card section" style="display:none; margin-top:16px">
          <h2>Configura√ß√µes</h2>
          <div style="display:flex; gap:12px">
            <div class="card">Tema: <b>Escuro</b></div>
            <div class="card">Salvar backup autom√°tico: <b>ON</b></div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- MODALS / HIDDEN INPUTS -->
  <input id="fileInput" type="file" accept="application/json" style="display:none" />

  <script>
    // ---------- Storage keys & helpers
    const KEYS = {P:'ps_products_v2', C:'ps_clients_v2', S:'ps_sales_v2'}
    const $ = id => document.getElementById(id)
    const money = n => Number(n||0).toFixed(2)
    const uid = p => p + '_' + Math.random().toString(36).slice(2,9)
    function load(k){try{return JSON.parse(localStorage.getItem(k)||'[]')}catch(e){return []}}
    function save(k,v){localStorage.setItem(k,JSON.stringify(v))}

    // ---------- In-memory
    let products = load(KEYS.P)
    let clients = load(KEYS.C)
    let sales = load(KEYS.S)
    let currentCart = []

    // ---------- UI: Navigation
    document.querySelectorAll('.nav-item').forEach(el=>el.addEventListener('click', ()=>{
      document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'))
      el.classList.add('active')
      showSection(el.dataset.section)
    }))
    function showSection(id){document.querySelectorAll('.section').forEach(s=>s.style.display = s.id===id ? '' : 'none'); refreshAll()}

    // ---------- Quick actions
    $('newProductBtn').addEventListener('click', ()=>{$('p_name').focus(); showSection('estoque')})
    $('newClientBtn').addEventListener('click', ()=>{$('c_name').focus(); showSection('clientes')})
    $('newSaleBtn').addEventListener('click', ()=>{showSection('vendas'); $('startSale').click()})
    $('clearAllBtn').addEventListener('click', ()=>{if(confirm('Apagar todos os dados?')){localStorage.removeItem(KEYS.P); localStorage.removeItem(KEYS.C); localStorage.removeItem(KEYS.S); products=[];clients=[];sales=[];refreshAll()}})

    // ---------- Export / Import
    $('exportBtn').addEventListener('click', ()=>{
      const data = {products, clients, sales, exportedAt:new Date().toISOString()}
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'})
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='pdv-petshop-backup.json'; a.click(); URL.revokeObjectURL(url)
    })
    $('importBtn').addEventListener('click', ()=>$('fileInput').click())
    $('fileInput').addEventListener('change', e=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ev => {
        try{ const data = JSON.parse(ev.target.result); if(data.products) products = data.products; if(data.clients) clients = data.clients; if(data.sales) sales = data.sales; save(KEYS.P, products); save(KEYS.C, clients); save(KEYS.S, sales); alert('Importa√ß√£o conclu√≠da'); refreshAll()}catch(err){alert('Arquivo inv√°lido')}
      }; reader.readAsText(f)
    })

    // ---------- Quick search
    $('quickSearch').addEventListener('input', e=>{const q=e.target.value.toLowerCase(); if(!q){refreshAll();return} renderFiltered(q)})
    function renderFiltered(q){renderProducts(q); renderClients(q)}

    // ---------- Products
    function renderProducts(filter=''){
      const tbody = $('prodTableBody'); tbody.innerHTML=''
      const list = products.filter(p=>!filter || (p.name+p.sku+p.price).toLowerCase().includes(filter))
      list.forEach(p=>{
        const tr=document.createElement('tr')
        tr.innerHTML = `<td>${p.sku||''}</td><td>${p.name}</td><td>R$ ${money(p.price)}</td><td>${p.qty}</td><td><button class='btn' data-id='${p.id}' data-action='edit'>Editar</button> <button class='btn ghost danger' data-id='${p.id}' data-action='del'>Excluir</button></td>`
        tbody.appendChild(tr)
      })
      $('prodCount').textContent = list.length
      tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
        const id = e.target.dataset.id; const action = e.target.dataset.action
        if(action==='edit'){editProduct(id)} else if(action==='del'){ if(confirm('Excluir produto?')){products = products.filter(x=>x.id!==id); save(KEYS.P, products); refreshAll()} }
      }))
      fillSelectors()
    }
    function editProduct(id){const p = products.find(x=>x.id===id); if(!p) return; $('p_name').value=p.name; $('p_sku').value=p.sku; $('p_price').value=p.price; $('p_qty').value=p.qty; $('saveProductBtn').dataset.edit = id; showSection('estoque')}

    $('saveProductBtn').addEventListener('click', ()=>{
      const name=$('p_name').value.trim(); const sku=$('p_sku').value.trim(); const price=parseFloat($('p_price').value||0); const qty=parseInt($('p_qty').value||0)
      if(!name){alert('Nome obrigat√≥rio'); return}
      const eid = $('saveProductBtn').dataset.edit
      if(eid){const p = products.find(x=>x.id===eid); p.name=name; p.sku=sku; p.price=price; p.qty=qty; delete $('saveProductBtn').dataset.edit}
      else products.push({id:uid('P'), name, sku, price, qty})
      save(KEYS.P, products); $('p_name').value=''; $('p_sku').value=''; $('p_price').value=''; $('p_qty').value=''; refreshAll()
    })
    $('resetProductBtn').addEventListener('click', ()=>{['p_name','p_sku','p_price','p_qty'].forEach(id=>$(id).value='')})

    // ---------- Clients
    function renderClients(filter=''){
      const tbody = $('clientTableBody'); tbody.innerHTML=''
      const list = clients.filter(c=>!filter || (c.name+c.email+c.phone).toLowerCase().includes(filter))
      list.forEach(c=>{
        const tr=document.createElement('tr')
        tr.innerHTML = `<td>${c.name}</td><td>${c.phone||''}</td><td>${c.email||''}</td><td><button class='btn' data-id='${c.id}' data-action='edit'>Editar</button> <button class='btn ghost danger' data-id='${c.id}' data-action='del'>Excluir</button></td>`
        tbody.appendChild(tr)
      })
      $('clientCount').textContent = list.length
      tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
        const id=e.target.dataset.id; const action=e.target.dataset.action
        if(action==='edit'){editClient(id)} else if(action==='del'){ if(confirm('Excluir cliente?')){clients = clients.filter(x=>x.id!==id); save(KEYS.C, clients); refreshAll()} }
      }))
    }
    function editClient(id){const c=clients.find(x=>x.id===id); if(!c) return; $('c_name').value=c.name; $('c_phone').value=c.phone||''; $('c_email').value=c.email||''; $('c_note').value=c.note||''; $('saveClientBtn').dataset.edit = id; showSection('clientes')}

    $('saveClientBtn').addEventListener('click', ()=>{
      const name=$('c_name').value.trim(); const phone=$('c_phone').value.trim(); const email=$('c_email').value.trim(); const note=$('c_note').value.trim()
      if(!name){alert('Nome obrigat√≥rio'); return}
      const eid = $('saveClientBtn').dataset.edit
      if(eid){const c = clients.find(x=>x.id===eid); c.name=name; c.phone=phone; c.email=email; c.note=note; delete $('saveClientBtn').dataset.edit}
      else clients.push({id:uid('C'), name, phone, email, note})
      save(KEYS.C, clients); ['c_name','c_phone','c_email','c_note'].forEach(id=>$(id).value=''); refreshAll()
    })
    $('resetClientBtn').addEventListener('click', ()=>{['c_name','c_phone','c_email','c_note'].forEach(id=>$(id).value='')})

    // ---------- Sales / Cart
    function fillSelectors(){
      const saleClient = $('saleClient'); const saleProduct = $('saleProduct'); const fastProduct = $('fastProduct'
      )
      saleClient.innerHTML=''; saleProduct.innerHTML=''; fastProduct.innerHTML=''
      clients.forEach(c=>{const opt=document.createElement('option'); opt.value=c.id; opt.text=c.name; saleClient.appendChild(opt)})
      products.forEach(p=>{const opt=document.createElement('option'); opt.value=p.id; opt.text=`${p.name} ‚Äî R$ ${money(p.price)} ‚Äî q:${p.qty}`; saleProduct.appendChild(opt); fastProduct.appendChild(opt.cloneNode(true))})
    }

    $('startSale').addEventListener('click', ()=>{
      if(!clients.length || !products.length){alert('Cadastre ao menos 1 cliente e 1 produto'); return}
      currentCart=[]; $('posArea').style.display='block'; $('saleDate').value = new Date().toISOString().split('T')[0]; renderCart()
    })

    $('addItemBtn').addEventListener('click', ()=>{
      const pid=$('saleProduct').value; const qty=parseInt($('saleQty').value||1); const p = products.find(x=>x.id===pid)
      if(!p){alert('Produto inv√°lido'); return}
      if(qty<=0){alert('Quantidade inv√°lida'); return}
      const exists=currentCart.find(i=>i.productId===pid)
      if(exists) exists.qty += qty; else currentCart.push({productId:pid, qty, price:p.price})
      renderCart()
    })

    function renderCart(){
      const tbody = $('cartTableBody'); tbody.innerHTML=''; let total=0; let items=0
      currentCart.forEach((it, idx)=>{
        const p = products.find(x=>x.id===it.productId) || {name:'--'}
        const sub = it.qty * it.price; total += sub; items += it.qty
        const tr = document.createElement('tr')
        tr.innerHTML = `<td>${p.name}</td><td>${it.qty}</td><td>R$ ${money(it.price)}</td><td>R$ ${money(sub)}</td><td><button class='btn ghost danger' data-idx='${idx}'>Remover</button></td>`
        tbody.appendChild(tr)
      })
      tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{ const i = parseInt(e.target.dataset.idx); currentCart.splice(i,1); renderCart()}))
      $('saleItemsCount').textContent = items; $('saleTotal').textContent = money(total); $('saleReceipt').textContent = generateReceipt(total)
    }

    $('finishSaleBtn').addEventListener('click', ()=>{
      if(!currentCart.length){alert('Carrinho vazio'); return}
      const cid = $('saleClient').value; const date = $('saleDate').value || new Date().toISOString().split('T')[0]
      currentCart.forEach(it=>{const p = products.find(x=>x.id===it.productId); if(p) p.qty = Number(p.qty) - Number(it.qty)})
      const total = parseFloat($('saleTotal').textContent||0)
      const newSale = {id:uid('S'), date, clientId:cid, items: JSON.parse(JSON.stringify(currentCart)), total}
      sales.unshift(newSale); save(KEYS.S, sales); save(KEYS.P, products); currentCart=[]; $('posArea').style.display='none'; alert('Venda registrada'); refreshAll()
    })

    function generateReceipt(total){
      const client = clients.find(c=>c.id==$('saleClient').value) || {name:'--'}
      const lines=['PETSHOP ‚Äî COMPROVANTE', 'Data: '+ $('saleDate').value, 'Cliente: '+client.name, '-------------------------']
      currentCart.forEach(it=>{const p = products.find(x=>x.id===it.productId)||{}; lines.push(`${p.name} x${it.qty} R$ ${money(it.price)} = R$ ${money(it.qty*it.price)}`)})
      lines.push('-------------------------'); lines.push('TOTAL: R$ '+money(total)); lines.push('\nObrigado!')
      return lines.join('\n')
    }

    // Fast cart (painel)
    let fastCart = []
    function renderFastOptions(){ const sel = $('fastProduct'); sel.innerHTML=''; products.forEach(p=>{const opt=document.createElement('option'); opt.value=p.id; opt.text=`${p.name} ‚Äî q:${p.qty}`; sel.appendChild(opt)}) }
    $('fastAdd').addEventListener('click', ()=>{ const pid=$('fastProduct').value; const qty=parseInt($('fastQty').value||1); const p=products.find(x=>x.id===pid); if(!p) return; const ex=fastCart.find(x=>x.productId===pid); if(ex) ex.qty+=qty; else fastCart.push({productId:pid, qty, price:p.price}); renderFastCart() })
    function renderFastCart(){ const div=$('fastCartList'); div.innerHTML=''; let total=0; fastCart.forEach((it, i)=>{ const p=products.find(x=>x.id===it.productId)||{}; const el=document.createElement('div'); el.className='cart-item'; el.innerHTML=`<div>${p.name} <div class='muted-sm'>x${it.qty}</div></div><div>R$ ${money(it.qty*it.price)} <div><button class='btn ghost' data-i='${i}'>Remover</button></div></div>`; div.appendChild(el) })
      div.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{ fastCart.splice(Number(e.target.dataset.i),1); renderFastCart() }))
      fastCart.forEach(it=>{ total += it.qty * it.price }); $('fastTotal').textContent = money(total)
    }
    $('fastCheckout').addEventListener('click', ()=>{ if(!fastCart.length){alert('Carrinho vazio'); return} // require client
      if(!clients.length){alert('Cadastre um cliente'); return} const clientId = clients[0].id; const date = new Date().toISOString().split('T')[0]; const total = fastCart.reduce((s,i)=>s + i.qty*i.price,0); const newSale={id:uid('S'), date, clientId, items: JSON.parse(JSON.stringify(fastCart)), total}; sales.unshift(newSale); fastCart.forEach(it=>{const p=products.find(x=>x.id===it.productId); if(p) p.qty -= it.qty}); save(KEYS.S,sales); save(KEYS.P,products); fastCart=[]; renderFastCart(); refreshAll(); alert('Venda r√°pida registrada') })

    // ---------- History
    function renderSalesHistory(){ const tbody=$('salesHistoryBody'); tbody.innerHTML=''; sales.forEach(s=>{ const client=clients.find(c=>c.id===s.clientId)||{name:'--'}; const tr=document.createElement('tr'); tr.innerHTML=`<td>${s.date}</td><td>${client.name}</td><td>${s.items.length}</td><td>R$ ${money(s.total)}</td><td><button class='btn' data-id='${s.id}'>Ver</button></td>`; tbody.appendChild(tr) }); tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{ const id=e.target.dataset.id; const s=sales.find(x=>x.id===id); if(s){ alert('Venda '+s.id+'\nCliente: '+(clients.find(c=>c.id===s.clientId)||{}).name+'\nTotal: R$ '+money(s.total)+'\nItens: '+s.items.map(i=>{const p=products.find(x=>x.id===i.productId)||{}; return (p.name||'??')+' x'+i.qty}).join(', ')) } })) }

    // ---------- Helpers & init
    function refreshAll(){ products = load(KEYS.P); clients = load(KEYS.C); sales = load(KEYS.S); renderProducts(); renderClients(); renderSalesHistory(); fillSelectors(); renderFastOptions(); renderFastCart(); renderStats(); renderCart(); }
    function renderStats(){ $('statProducts').textContent = products.length; $('statClients').textContent = clients.length; const totalSales = sales.reduce((s,x)=>s + (Number(x.total)||0),0); $('statSales').textContent = 'R$ '+money(totalSales) }

    // sample data to help start
    if(!products.length && !clients.length){
      products = [ {id:uid('P'), sku:'RAC001', name:'Ra√ß√£o Premium 10kg', price:189.9, qty:12}, {id:uid('P'), sku:'SHM002', name:'Shampoo Pets 500ml', price:29.9, qty:30}, {id:uid('P'), sku:'CL003', name:'Coleira Ajust√°vel', price:39.9, qty:20} ]
      clients = [ {id:uid('C'), name:'Jo√£o Silva', phone:'(11)99999-0000', email:'joao@mail.com'}, {id:uid('C'), name:'Maria Santos', phone:'(11)98888-1111', email:'maria@mail.com'} ]
      save(KEYS.P, products); save(KEYS.C, clients); refreshAll()
    } else refreshAll()

    // helper: simulate barcode scan
    $('btnScan').addEventListener('click', ()=>{ const input = prompt('Digite SKU ou nome do produto para adicionar:'); if(!input) return; const p = products.find(x=> x.sku===input || x.name.toLowerCase().includes(input.toLowerCase())); if(p){ currentCart.push({productId:p.id, qty:1, price:p.price}); $('posArea').style.display='block'; renderCart(); } else alert('Produto n√£o encontrado') })

    // print receipt
    $('btnPrintReceipt').addEventListener('click', ()=>{ const content = $('saleReceipt').textContent || '‚Äî'; const w = window.open('', '_blank'); w.document.write('<pre style="font-family:monospace; font-size:14px">'+content+'</pre>'); w.print(); w.close(); })

  </script>
</body>
</html>